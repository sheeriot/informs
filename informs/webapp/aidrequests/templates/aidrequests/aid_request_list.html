{% extends "base.html" %}

{% load static %}
{% load custom_tags %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <div class="d-flex align-items-center mb-3">
        <div class="d-flex align-items-center">
            <h2 class="mb-0 me-2">Aid Requests List</h2>
            <a class="btn btn-info" href="{% url 'field_op_detail' slug=field_op.slug %}">
                <i class="bi bi-truck"></i>
                {{ field_op.name }}
            </a>
        </div>
        <div class="ms-2">
            {% if field_op.disable_cot %}
            <span class="badge bg-danger">
                <i class="bi bi-x-circle"></i> COT Disabled
            </span>
            {% else %}
            <button id="tak-alert-button" class="btn btn-danger">
                <i class="bi bi-bullseye me-1"></i>Alert TAK
            </button>
            {% endif %}
        </div>
    </div>

    <!-- Aid Requests Filter section -->
    {% include "aidrequests/includes/aid_requests_filter.html" %}

    <!-- Aid Requests Map and List sections -->
    <div class="row">
        <!-- Aid Requests Map Section -->
        {% include "aidrequests/includes/aid_requests_map.html" %}

        <!-- Aid Requests List/Table -->
        {% include "aidrequests/includes/aid_requests_table.html" %}
    </div>

</div>

<!-- Data Section -->
<div class="d-none">
    <!-- Aid requests data - Combined format for both map and list -->
    <script id="aid-locations-data" type="application/json">
        {{ aid_requests_json|safe }}
    </script>

    <!-- Filter data -->
    {% if aid_types_json %}
        <script id="aid-types-json" type="application/json">{{ aid_types_json|safe }}</script>
    {% endif %}
    {{ status_choices_json|default:'[]'|json_script:'status-choices-data' }}
    {{ priority_choices_json|default:'[]'|json_script:'priority-choices-data' }}
</div>

<!-- CSRF Token for AJAX requests -->
{% csrf_token %}
{% endblock %}

{% block extra_css %}
<!-- Azure Maps CSS -->
<link href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" rel="stylesheet" />
<link href="{% static 'css/azure-maps-layer-legend.css' %}" rel="stylesheet" />
{% endblock %}

{% block extra_js %}
<!-- Azure Maps JavaScript -->
<script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>
<!-- Azure Maps Layer Legend -->
<script src="{% static 'js/azure-maps-layer-legend.js' %}?v={{static_version}}"></script>
<!-- Application JavaScript -->
<script src="{% static 'js/aidrequests-filter.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/aidrequests-list.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/map_aidrequests.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/aidrequests-ajax.js' %}?v={{static_version}}"></script>
{% endblock %}
