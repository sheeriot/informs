{% extends "base.html" %}

{% load static %}
{% load custom_tags %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <h2 class="mb-3">Aid Requests: {{ field_op.name }}
        <a href="{% url 'field_op_detail' pk=field_op.pk %}" class="btn btn-outline-info btn-sm">
            <i class="bi bi-truck"></i>
        </a>
    </h2>
    {% if field_op.disable_cot %}
        <div class="mb-3">
            <span class="badge bg-danger">
                <i class="bi bi-x-circle"></i> COT Disabled
            </span>
        </div>
    {% else %}
        <div class="mb-3">
            {% include "aidrequests/includes/tak_buttons.html" %}
        </div>
    {% endif %}

    <!-- Aid Requests Filter section -->
    {% include "aidrequests/includes/aid_requests_filter.html" %}

    <!-- Aid Requests Buttons section -->
    <div class="d-flex justify-content-between align-items-center mt-4">
        <div>
            <a href="{% url 'aid_request_create' field_op=field_op.slug %}" class="btn btn-success">
                <i class="bi bi-plus-circle me-2"></i>Add
            </a>
        </div>
        <div>
            <a href="{% url 'aid_requests_csv' field_op=field_op.slug %}" class="btn btn-info">
                <i class="bi bi-download me-2"></i>Export
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Aid Requests Map Section -->
        {% include "aidrequests/includes/aid_requests_map.html" %}

        <!-- Aid Requests List/Table -->
        {% include "aidrequests/includes/aid_requests_table.html" %}


    </div>

</div>

<!-- Data Section -->
<div class="d-none">
    <!-- Aid requests data - Combined format for both map and list -->
    <script id="aid-locations-data" type="application/json">
        {{ aid_requests_json|safe }}
    </script>

    <!-- Filter data -->
    {% if aid_types_json %}
        <script id="aid-types-json" type="application/json">{{ aid_types_json|safe }}</script>
    {% endif %}
    {{ status_choices_json|default:'[]'|json_script:'status-choices-data' }}
    {{ priority_choices_json|default:'[]'|json_script:'priority-choices-data' }}
    <span id="field-op-name" class="d-none">{{ field_op.name }}</span>
    <span id="field-op-slug" class="d-none">{{ field_op.slug }}</span>
</div>

<!-- CSRF Token for AJAX requests -->
{% csrf_token %}
{% endblock %}

{% block extra_css %}
<!-- Azure Maps CSS -->
<link href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" rel="stylesheet" />
<link href="{% static 'css/azure-maps-layer-legend.css' %}" rel="stylesheet" />
{% endblock %}

{% block extra_js %}
<!-- Azure Maps JavaScript -->
<script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>
<!-- Azure Maps Layer Legend -->
<script src="{% static 'js/azure-maps-layer-legend.js' %}?v={{static_version}}"></script>
<!-- Application JavaScript -->
<script src="{% static 'js/aidrequests-filter.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/aidrequests-list.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/map_aidrequests.js' %}?v={{static_version}}"></script>
<script src="{% static 'js/aidrequests-ajax.js' %}?v={{static_version}}"></script>
{% endblock %}
